<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Warga LA6 & Kavling</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://la6.my.id/admin/style.css"></link>
</head>
<body>

    <div id="loading-overlay"><div class="spinner"></div></div>
    <div id="toast-container" class="toast-container"></div>

    <header id="main-header" class="hidden">
        <div class="brand">
            <img src="https://avatars.githubusercontent.com/u/61934361?v=4" class="brand-logo" alt="Logo">
            <span id="header-title">Manajemen Warga</span>
        </div>
    </header>

    <section id="login-view">
        <div class="login-card">
            <h2 style="margin-bottom: 0.5rem;">Login Admin</h2>
            <p style="margin-bottom: 2rem; color: var(--secondary); font-size: 0.9rem;">Masuk untuk mengelola data warga</p>
            
            <div class="input-group hidden">
                <label>URL Web App</label>
                <input type="url" id="app-url" class="input-field" value="https://script.google.com/macros/s/AKfycbwopjwy5tR4Q1q3q8oHOYZ83VKaDGekoM8hULbX-5jb460XCFREvv9cDZRVb50voHmaOw/exec" readonly>
            </div>
            
            <div class="input-group">
                <label>Pengurus</label>
                <input type="text" id="sheet-name" class="input-field" value="Jimpitan" placeholder="Contoh: Bendahara, Jimpitan">
            </div>

            <div class="input-group">
                <label>Password</label>
                <input type="password" id="api-token" class="input-field" placeholder="Masukkan Password">
            </div>
            
            <button class="btn-login" onclick="doLogin()">Masuk Dashboard</button>
        </div>
    </section>

    <main>
        <!-- VIEW 1: PEMBAYARAN -->
        <section id="view-pembayaran" class="view-section active">
            <div class="search-container">
                <input type="text" id="search-box" class="search-input" placeholder="Cari Blok atau Nama..." onkeyup="filterCards()">
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Uang Masuk 2026</div>
                    <div class="stat-value" id="stat-pemasukan">Rp 0</div>
                </div>
                <div class="stat-card tunggakan">
                    <div class="stat-title">Tunggakan</div>
                    <div class="stat-value" id="stat-tunggakan" style="color: var(--danger);">Rp 0</div>
                </div>
            </div>

            <div id="card-container" class="card-grid"></div>
            <div id="empty-state" class="hidden" style="text-align: center; margin-top: 3rem; color: var(--secondary);"><p>Data tidak ditemukan.</p></div>
        </section>

        <!-- VIEW 2: REKAP -->
        <section id="view-rekap" class="view-section">
            <h2 style="margin-bottom: 1.5rem;">Rekapitulasi Bulanan</h2>
            <div class="rekap-list" id="rekap-container"></div>
        </section>

        <!-- VIEW 3: RIWAYAT -->
        <section id="view-riwayat" class="view-section">
            <h2 style="margin-bottom: 1.5rem;">Riwayat Pembayaran (<span id="riwayat-sheet-name"></span>)</h2>
            <div id="riwayat-container" class="riwayat-list">
                <div style="text-align: center; padding: 2rem; color: var(--secondary);">
                    <p>Klik tab Riwayat untuk memuat data...</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" id="main-nav" style="display:none;">
        <div class="nav-item active" onclick="switchTab('pembayaran', this)">
            <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
            <span>Pembayaran</span>
        </div>
        <div class="nav-item" onclick="switchTab('rekap', this)">
            <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10h.01M9 17h.01M9 17l.01.01M12 12l-3.5-6m11.5 6l-1 1m-14.5 6l3.5-6m4.5 6l-1 1m-14.5 6l3.5-6m4.5 6l1 1"></path></svg>
            <span>Rekap</span>
        </div>
        <div class="nav-item" onclick="switchTab('riwayat', this)">
            <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span>Riwayat</span>
        </div>
        <div class="nav-item" onclick="openSettingsModal()">
            <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317l.426-5.355a1.99 1.99 0 012.827-1.764l3.975.424a4.5 4.5 0 00-6.373-3.006l4.91 2.535zM17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path></svg>
            <svg viewBox="0 0 24 24" style="position:absolute;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
            <span>Pengaturan</span>
        </div>
    </nav>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header-bg">
                <button class="btn-close-edit" onclick="closeModal('edit-modal')">&times;</button>
                <img id="modal-avatar" src="" class="modal-profile-img" alt="Profile">
                <div class="modal-profile-name" id="modal-nama">Nama Warga</div>
                <div class="modal-profile-blok" id="modal-blok">Blok A1</div>
            </div>
            
            <div class="modal-body">
                <form id="edit-form" onsubmit="event.preventDefault(); saveData();">
                    <div id="general-fields" style="margin-bottom: 1rem; display: none;"></div>
                    
                    <div class="form-section-title">
                        <span>Pembayaran</span>
                        <span id="btn-kurang-modal" class="kurang-text-link" onclick="autoFillKurang()">Rp 0</span>
                    </div>
                    
                    <div id="monthly-fields"></div>
                </form>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-save" onclick="document.getElementById('edit-form').requestSubmit()">Bayar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal modal-settings">
            <div class="modal-header-simple">
                <div class="modal-title">Pengaturan Sistem</div>
                <button class="btn-close-icon" onclick="closeModal('settings-modal')">&times;</button>
            </div>
            
            <div class="settings-body">
                <div class="settings-buttons-row">
                    <button class="btn-share" onclick="shareSheet()">
                        <span>ðŸ”—</span> Bagikan
                    </button>
                    <button class="btn-logout" onclick="handleLogout()">
                        <span>ðŸšª</span> Keluar Akun
                    </button>
                </div>

                <div class="form-section-title" style="margin-top: 2rem;">Ganti Password Sheet</div>
                <form id="settings-form" onsubmit="event.preventDefault(); updateTokenAction();">
                    <input type="hidden" id="set-sheet-target" value="">
                    <div class="input-group">
                        <label>Password Lama</label>
                        <input type="password" id="old-token" class="input-field" placeholder="Masukkan password saat ini">
                    </div>
                    <div class="input-group">
                        <label>Password Baru</label>
                        <input type="password" id="new-token" class="input-field" placeholder="Masukkan password baru">
                    </div>
                    
                    <button type="submit" class="btn-update-pass">Update Password</button>
                </form>
            </div>
        </div>
    </div>

    <script async src="https://la6.my.id/admin/script.js"></script>
</body>
</html>
