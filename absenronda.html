<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Aben Ronda</title>
    <link href="https://placehold.co/40x40" rel="icon" type="image/jpeg"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <style>
	@media print {
            body {
                zoom: 75%;
            }
	#tutorialPopup{display:none;}
        }    
        .draggable {
            position: fixed;
        }
        .my-5 {
            margin-top: 0rem;
            margin-bottom: -1rem;
        }
        .hari {
            width: 100px;
        }
        .blok {
            min-width: 40px;
            max-width: 50px;
            background: black;
            color: #fff;
        }
        .nama {
            min-width: 165px;
            max-width: 165px;
        }
        form#settingsDataForm {
            max-height: 500px;
            overflow: auto;
        }
        html {
            overflow: scroll;
        }
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent; /* make scrollbar transparent */
        }
        @media print {
            body {
                zoom: 61%;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen" onclick="handleClick()">
    <!-- Header -->
    <header class="bg-gradient-to-r from-orange-400 to-orange-300 p-4 flex justify-between items-center">
        <div class="flex items-center">
            <img alt="Logo of Admin Jimpitan, a circular logo with a placeholder design" class="h-10 w-10 rounded-full" height="40" src="././logo.png" width="40"/>
            <span class="text-white font-bold ml-2">Absen Ronda</span>
        </div>
        <div class="relative">
            <div class="flex items-center space-x-4">
                <i class="fas fa-bars text-white cursor-pointer" onclick="toggleMenu()"></i>
            </div>
            <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-2 z-20 hidden" id="dropdownMenu">
                <a class="block px-4 py-2 text-gray-800 hover:bg-gray-200 cursor-pointer" onclick="toggleSettingsPopup()">Setting</a>
                <a class="block px-4 py-2 text-gray-800 hover:bg-gray-200" href="#">Bendahara</a>
                <a class="block px-4 py-2 text-gray-800 hover:bg-gray-200" href="#">Jimpitan</a>
            </div>
        </div>
    </header>
    <!-- Main Content -->
    <main class="flex-grow p-4">
        <div class="container mx-auto text-center">
            <h1 class="text-2xl font-bold mb-4" id="scheduleTitle"></h1>
            <div id="tablesContainer" class="overflow-x-auto">
                <!-- Tables will be dynamically generated -->
            </div>
        </div>
        <br/>
        <br/>
        <br/>
        <br/>
        <center>@2024 oleh YOUSHE</center>
    </main>

    <!-- Floating Plus Button -->
    <div class="draggable bg-yellow-500 text-white h-12 w-12 flex items-center justify-center rounded-full shadow-lg" id="draggable-plus" onclick="toggleDatePopup()" style="right: 10px; bottom: 50%; transform: translateY(50%);">
        <i class="fas fa-plus text-lg"></i>
    </div>

    <!-- Floating Print Button -->
    <div class="draggable bg-green-500 text-white h-12 w-12 flex items-center justify-center rounded-full shadow-lg" id="draggable-print" onclick="printContent()" style="right: 10px; bottom: 40%; transform: translateY(50%);">
        <i class="fas fa-print text-lg"></i>
    </div>
    <!-- Date Popup Form -->
    <div class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden" id="datePopupForm">
        <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 md:w-1/2 lg:w-1/3">
            <h2 class="text-xl font-bold mb-4">Pilih Bulan</h2>
            <form id="datePopupDataForm">
                <div class="mb-4">
                    <label class="block text-gray-700" for="startDate">Mulai Tanggal:</label>
                    <input class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="startDate" type="date"/>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700" for="endDate">Berhenti Tanggal:</label>
                    <input class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="endDate" type="date"/>
                </div>
                <div class="flex justify-end">
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-md mr-2" onclick="generateSchedule()" type="button">Buat Jadwal</button>
                    <button class="bg-gray-500 text-white px-4 py-2 rounded-md" onclick="toggleDatePopup()" type="button">Batal</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Settings Popup Form -->
    <div class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden" id="settingsPopupForm">
        <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 md:w-1/2 lg:w-1/3">
            <h2 class="text-xl font-bold mb-4">Settings</h2>
            <form id="settingsDataForm">
                <div class="grid grid-cols-2 gap-4">
                    <div class="mb-4">
                        <label class="block text-gray-700" for="mondayTextArea">Senin:</label>
                        <textarea class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="mondayTextArea" placeholder="Nama1,Blok1
Nama2,Blok2
Nama3,Blok3
Nama4,Blok4" required="" rows="4" maxlength="100" oninput="validateTextarea(this)"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700" for="tuesdayTextArea">Selasa:</label>
                        <textarea class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="tuesdayTextArea" placeholder="Nama1,Blok1
Nama2,Blok2
Nama3,Blok3
Nama4,Blok4" required="" rows="4" maxlength="100" oninput="validateTextarea(this)"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700" for="wednesdayTextArea">Rabu:</label>
                        <textarea class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="wednesdayTextArea" placeholder="Nama1,Blok1
Nama2,Blok2
Nama3,Blok3
Nama4,Blok4" required="" rows="4" maxlength="100" oninput="validateTextarea(this)"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700" for="thursdayTextArea">Kamis:</label>
                        <textarea class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="thursdayTextArea" placeholder="Nama1,Blok1
Nama2,Blok2
Nama3,Blok3
Nama4,Blok4" required="" rows="4" maxlength="100" oninput="validateTextarea(this)"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700" for="fridayTextArea">Jumat:</label>
                        <textarea class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="fridayTextArea" placeholder="Nama1,Blok1
Nama2,Blok2
Nama3,Blok3
Nama4,Blok4" required="" rows="4" maxlength="100" oninput="validateTextarea(this)"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700" for="saturdayTextArea">Sabtu:</label>
                        <textarea class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="saturdayTextArea" placeholder="Nama1,Blok1
Nama2,Blok2
Nama3,Blok3
Nama4,Blok4" required="" rows="4" maxlength="100" oninput="validateTextarea(this)"></textarea>
                    </div>
                    <div class="mb-4 col-span-2">
                        <label class="block text-gray-700" for="sundayTextArea">Minggu:</label>
                        <textarea class="mt-1 block w-full p-2 border border-gray-300 rounded-md" id="sundayTextArea" placeholder="Nama1,Blok1
Nama2,Blok2
Nama3,Blok3
Nama4,Blok4" required="" rows="4" maxlength="100" oninput="validateTextarea(this)"></textarea>
                    </div>
                </div>
                
            </form>
			<div class="flex justify-end">
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-md mr-2" onclick="saveSettingsData()" type="button">Save</button>
                    <button class="bg-gray-500 text-white px-4 py-2 rounded-md" onclick="toggleSettingsPopup()" type="button">Cancel</button>
                </div>
        </div>
    </div>
    <!-- Tutorial Popup -->
    <div class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center" id="tutorialPopup">
        <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 md:w-1/2 lg:w-1/3">
            <h2 class="text-xl font-bold mb-4">Tutorial membuat absen ronda</h2>
            <div id="tutorialContent">
                <p class="mb-4">1. Pilih menu lalu masuk ke setting, dibagian setting ada nama nama hari masukkan nama dan blok di pisah dengan tanda "," misal: Agus, B11. Untuk menambah nama lain tekan enter dan ulangi langkah tadi. kemudian Simpan.</p>
                <p class="mb-4 hidden">2. Klik icon plus lalu akan muncul popup settingan bulan. Mulai tanggal artinya absen ronda dimulai dari tanggal (bebas). Berhenti tanggal artinya kita dapat menentukan sampai tanggal berapun yang kita mau. Klik Buat jadwal.</p>
                <p class="mb-4 hidden">3. Klik icon Print untuk mencetaknya, jika ingin menyimpan ke PDF bagian destination pilih Save as PDF lalu klik Save.</p>
            </div>
            <div class="flex justify-end">
                <button class="bg-blue-500 text-white px-4 py-2 rounded-md" onclick="nextTutorialStep()">Next</button>
            </div>
        </div>
    </div>
    <script>
        let tutorialStep = 0;

        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('hidden');
        }

        function togglePopup() {
            const popup = document.getElementById('popupForm');
            popup.classList.toggle('hidden');
        }

        function toggleDatePopup() {
            const popup = document.getElementById('datePopupForm');
            popup.classList.toggle('hidden');
        }

        function toggleSettingsPopup() {
            const popup = document.getElementById('settingsPopupForm');
            popup.classList.toggle('hidden');
        }

        function validateTextarea(textarea) {
            const lines = textarea.value.split('\n');
            if (lines.length > 4) {
                textarea.value = lines.slice(0, 4).join('\n');
            }
        }

        function saveSettingsData() {
            const monday = document.getElementById('mondayTextArea').value.trim();
            const tuesday = document.getElementById('tuesdayTextArea').value.trim();
            const wednesday = document.getElementById('wednesdayTextArea').value.trim();
            const thursday = document.getElementById('thursdayTextArea').value.trim();
            const friday = document.getElementById('fridayTextArea').value.trim();
            const saturday = document.getElementById('saturdayTextArea').value.trim();
            const sunday = document.getElementById('sundayTextArea').value.trim();

            if (!monday || !tuesday || !wednesday || !thursday || !friday || !saturday || !sunday) {
                alert('Semua textarea wajib diisi.');
                return;
            }

            const settingsData = {
                monday,
                tuesday,
                wednesday,
                thursday,
                friday,
                saturday,
                sunday
            };

            localStorage.setItem('settingsData', JSON.stringify(settingsData));
            alert('Settings saved!');
            toggleSettingsPopup();
        }

        function loadSettingsData() {
            const settingsData = JSON.parse(localStorage.getItem('settingsData'));
            if (settingsData) {
                document.getElementById('mondayTextArea').value = settingsData.monday;
                document.getElementById('tuesdayTextArea').value = settingsData.tuesday;
                document.getElementById('wednesdayTextArea').value = settingsData.wednesday;
                document.getElementById('thursdayTextArea').value = settingsData.thursday;
                document.getElementById('fridayTextArea').value = settingsData.friday;
                document.getElementById('saturdayTextArea').value = settingsData.saturday;
                document.getElementById('sundayTextArea').value = settingsData.sunday;
            }
        }

        function generateSchedule() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            if (!startDate || !endDate) {
                alert('Pilih tanggal mulai dan tanggal berhenti.');
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);
            if (start > end) {
                alert('Tanggal mulai harus sebelum tanggal berhenti.');
                return;
            }

            const year = start.getFullYear();
            const month = start.getMonth();
            const dayNames = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];

            document.getElementById('scheduleTitle').innerText = `Absen Ronda ${monthNames[month]} ${year}`;

            const tablesContainer = document.getElementById('tablesContainer');
            tablesContainer.innerHTML = '';

            const settingsData = JSON.parse(localStorage.getItem('settingsData'));

            for (let date = start; date <= end; date.setDate(date.getDate() + 1)) {
                const day = date.getDate();
                const dayName = dayNames[date.getDay()];

                let headerData = ['', '', '', '', '', '', '', ''];
                if (settingsData) {
                    switch (dayName) {
                        case 'Senin':
                            headerData = settingsData.monday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Selasa':
                            headerData = settingsData.tuesday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Rabu':
                            headerData = settingsData.wednesday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Kamis':
                            headerData = settingsData.thursday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Jumat':
                            headerData = settingsData.friday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Sabtu':
                            headerData = settingsData.saturday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Minggu':
                            headerData = settingsData.sunday.split('\n').map(line => line.split(',')).flat();
                            break;
                    }
                }

                const table = document.createElement('div');
                table.classList.add('mb-2');
                table.innerHTML = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 text-center">
                            <thead>
                                <tr>
                                    <th class="py-2 border h-12 hari">Hari/Tgl</th>
                                    <th class="py-2 border h-12 nama">${headerData[0] || ''}</th>
                                    <th class="py-2 border h-12 blok">${headerData[1] || ''}</th>
                                    <th class="py-2 border h-12 nama">${headerData[2] || ''}</th>
                                    <th class="py-2 border h-12 blok">${headerData[3] || ''}</th>
                                    <th class="py-2 border h-12 nama">${headerData[4] || ''}</th>
                                    <th class="py-2 border h-12 blok">${headerData[5] || ''}</th>
                                    <th class="py-2 border h-12 nama">${headerData[6] || ''}</th>
                                    <th class="py-2 border h-12 blok">${headerData[7] || ''}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="px-4 py-2 border h-24">
                                        <div class="text-lg font-bold">${dayName}</div>
                                        <div class="text-3xl font-bold">${day}</div>
                                                                        </td>
                                    <td class="px-4 py-2 border h-24" id="name1Cell" colspan="2"></td>
                                    <td class="px-4 py-2 border h-24" id="name2Cell" colspan="2"></td>
                                    <td class="px-4 py-2 border h-24" id="name3Cell" colspan="2"></td>
                                    <td class="px-4 py-2 border h-24" id="name4Cell" colspan="2"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
                tablesContainer.appendChild(table);
            }
        }

        function printContent() {
            const printContents = document.getElementById('tablesContainer').innerHTML;
            const originalContents = document.body.innerHTML;
            document.body.innerHTML = `<h1 class="text-2xl font-bold mb-4">${document.getElementById('scheduleTitle').innerText}</h1>` + printContents;
            window.print();
            document.body.innerHTML = originalContents;
            window.location.reload();
        }

        function nextTutorialStep() {
            const tutorialContent = document.getElementById('tutorialContent');
            const steps = tutorialContent.querySelectorAll('p');
            if (tutorialStep < steps.length - 1) {
                steps[tutorialStep].classList.add('hidden');
                tutorialStep++;
                steps[tutorialStep].classList.remove('hidden');
            } else {
                document.getElementById('tutorialPopup').classList.add('hidden');
            }
        }

        window.onload = function() {
            loadSettingsData();
            document.addEventListener('click', function(event) {
                const menu = document.getElementById('dropdownMenu');
                if (!menu.contains(event.target) && !event.target.closest('.fa-bars')) {
                    menu.classList.add('hidden');
                }
            });
        };
	let clickCount = 0;
        function handleClick() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                clickCount++;
                if (clickCount >= 10) {
                    document.exitFullscreen();
                    clickCount = 0;
                }
            }
        }
    </script>
</body>
</html>
