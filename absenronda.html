<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <style>
        @media print {
            header, .no-print {
                display: none;
            }
            .print-table th, .print-table td {
                width: 12.5%;
                border: 1px solid black;
            }
            .print-table th:nth-child(3), .print-table th:nth-child(5), .print-table th:nth-child(7), .print-table 
th:nth-child(9), .print-table td:nth-child(3), .print-table td:nth-child(5), .print-table td:nth-child(7), .print-table 
td:nth-child(9) {
                
                color: #000;
            }
        }

 .print-table th, .print-table td {
               
                border: 1px solid black;
            }
#tablesContainer{zoom:65%}
.print-table th:nth-child(1){width:90px}
    </style>
</head>
<body onload="loadSettingsData()">
    <header class="no-print bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="no-print text-xl font-bold">Schedule App</h1>
        <div class="flex items-center space-x-4">
            <a href="#" class="no-print text-white" onclick="printContent()"><i class="fas fa-print"></i></a>
            <a href="#" class="no-print text-white" onclick="downloadPDF()"><i class="fas fa-file-pdf"></i></a>
            <div class="no-print relative">
                <i class="fas fa-bars text-2xl cursor-pointer" onclick="toggleMenu()"></i>
                <div id="dropdownMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden">
                    <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-200" onclick="togglePopup()">Generate Schedule</a>
                    <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-200" onclick="toggleSettingsPopup()">Settings</a>
                </div>
            </div>
        </div>
    </header>

    <main class="p-4">
        <div id="tablesContainer"></div>
    </main>

    <div id="popupForm" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-md shadow-md w-96">
            <h2 class="text-xl font-bold mb-4">Generate Schedule</h2>
            <label for="startDate" class="block mb-2">Start Date:</label>
            <input type="date" id="startDate" class="w-full mb-4 p-2 border rounded-md">
            <label for="endDate" class="block mb-2">End Date:</label>
            <input type="date" id="endDate" class="w-full mb-4 p-2 border rounded-md">
            <div class="flex justify-end">
                <button class="bg-blue-600 text-white px-4 py-2 rounded-md mr-2" onclick="generateSchedule()">Generate</button>
                <button class="bg-gray-600 text-white px-4 py-2 rounded-md" onclick="togglePopup()">Cancel</button>
            </div>
        </div>
    </div>

    <div id="settingsPopupForm" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-md shadow-md w-96">
            <h2 class="text-xl font-bold mb-4">Settings</h2>
            <label for="mondayTextArea" class="block mb-2">Monday:</label>
            <textarea id="mondayTextArea" class="w-full mb-4 p-2 border rounded-md" rows="4" oninput="validateTextarea(this)"></textarea>
            <label for="tuesdayTextArea" class="block mb-2">Tuesday:</label>
            <textarea id="tuesdayTextArea" class="w-full mb-4 p-2 border rounded-md" rows="4" oninput="validateTextarea(this)"></textarea>
            <label for="wednesdayTextArea" class="block mb-2">Wednesday:</label>
            <textarea id="wednesdayTextArea" class="w-full mb-4 p-2 border rounded-md" rows="4" oninput="validateTextarea(this)"></textarea>
            <label for="thursdayTextArea" class="block mb-2">Thursday:</label>
            <textarea id="thursdayTextArea" class="w-full mb-4 p-2 border rounded-md" rows="4" oninput="validateTextarea(this)"></textarea>
            <label for="fridayTextArea" class="block mb-2">Friday:</label>
            <textarea id="fridayTextArea" class="w-full mb-4 p-2 border rounded-md" rows="4" oninput="validateTextarea(this)"></textarea>
            <label for="saturdayTextArea" class="block mb-2">Saturday:</label>
            <textarea id="saturdayTextArea" class="w-full mb-4 p-2 border rounded-md" rows="4" oninput="validateTextarea(this)"></textarea>
            <label for="sundayTextArea" class="block mb-2">Sunday:</label>
            <textarea id="sundayTextArea" class="w-full mb-4 p-2 border rounded-md" rows="4" oninput="validateTextarea(this)"></textarea>
            <div class="flex justify-end">
                <button class="bg-blue-600 text-white px-4 py-2 rounded-md mr-2" onclick="saveSettingsData()">Save</button>
                <button class="bg-gray-600 text-white px-4 py-2 rounded-md" onclick="toggleSettingsPopup()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('hidden');
        }

        function togglePopup() {
            const popup = document.getElementById('popupForm');
            popup.classList.toggle('hidden');
        }

        function toggleSettingsPopup() {
            const popup = document.getElementById('settingsPopupForm');
            popup.classList.toggle('hidden');
        }

        function validateTextarea(textarea) {
            const lines = textarea.value.split('\n');
            if (lines.length > 4) {
                textarea.value = lines.slice(0, 4).join('\n');
            }
        }

        function saveSettingsData() {
            const monday = document.getElementById('mondayTextArea').value.trim();
            const tuesday = document.getElementById('tuesdayTextArea').value.trim();
            const wednesday = document.getElementById('wednesdayTextArea').value.trim();
            const thursday = document.getElementById('thursdayTextArea').value.trim();
            const friday = document.getElementById('fridayTextArea').value.trim();
            const saturday = document.getElementById('saturdayTextArea').value.trim();
            const sunday = document.getElementById('sundayTextArea').value.trim();

            if (!monday || !tuesday || !wednesday || !thursday || !friday || !saturday || !sunday) {
                alert('Semua textarea wajib diisi.');
                return;
            }

            const settingsData = {
                monday,
                tuesday,
                wednesday,
                thursday,
                friday,
                saturday,
                sunday
            };

            localStorage.setItem('settingsData', JSON.stringify(settingsData));
            alert('Settings saved!');
            toggleSettingsPopup();
        }

        function loadSettingsData() {
            const settingsData = JSON.parse(localStorage.getItem('settingsData'));
            if (settingsData) {
                document.getElementById('mondayTextArea').value = settingsData.monday;
                document.getElementById('tuesdayTextArea').value = settingsData.tuesday;
                document.getElementById('wednesdayTextArea').value = settingsData.wednesday;
                document.getElementById('thursdayTextArea').value = settingsData.thursday;
                document.getElementById('fridayTextArea').value = settingsData.friday;
                document.getElementById('saturdayTextArea').value = settingsData.saturday;
                document.getElementById('sundayTextArea').value = settingsData.sunday;
            }
        }

        function generateSchedule() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            if (!startDate || !endDate) {
                alert('Pilih tanggal mulai dan tanggal berhenti.');
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);
            if (start > end) {
                alert('Tanggal mulai harus sebelum tanggal berhenti.');
                return;
            }

            const year = start.getFullYear();
            const month = start.getMonth();
            const dayNames = ["Ming", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            const monthNames = ["Jan", "Febru", "Maret", "April", "Mei", "Juni", "Juli", "Agust", "Sept", "Okt", "Nov", "Des"];

            const tablesContainer = document.getElementById('tablesContainer');
            tablesContainer.innerHTML = '';

            const settingsData = JSON.parse(localStorage.getItem('settingsData'));

            for (let date = start; date <= end; date.setDate(date.getDate() + 1)) {
                const day = date.getDate();
                const dayName = dayNames[date.getDay()];

                let headerData = ['', '', '', '', '', '', '', ''];
                if (settingsData) {
                    switch (dayName) {
                        case 'Senin':
                            headerData = settingsData.monday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Selasa':
                            headerData = settingsData.tuesday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Rabu':
                            headerData = settingsData.wednesday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Kamis':
                            headerData = settingsData.thursday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Jumat':
                            headerData = settingsData.friday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Sabtu':
                            headerData = settingsData.saturday.split('\n').map(line => line.split(',')).flat();
                            break;
                        case 'Minggu':
                            headerData = settingsData.sunday.split('\n').map(line => line.split(',')).flat();
                            break;
                    }
                }

                const table = document.createElement('div');
                table.classList.add('mb-2', 'print-container');
                table.innerHTML = `
                    <div>
                        <table class="min-w-full bg-white border border-gray-200 text-center print-table">
                            <thead>
                                <tr>
                                    <th class="py-2 border h-12 hari">${monthNames[month]}</th>
                                    <th class="py-2 border h-12 nama">${headerData[0] || ''}</th>
                                    <th class="py-2 border h-12 blok">${headerData[1] || ''}</th>
                                    <th class="py-2 border h-12 nama">${headerData[2] || ''}</th>
                                    <th class="py-2 border h-12 blok">${headerData[3] || ''}</th>
                                    <th class="py-2 border h-12 nama">${headerData[4] || ''}</th>
                                    <th class="py-2 border h-12 blok">${headerData[5] || ''}</th>
                                    <th class="py-2 border h-12 nama">${headerData[6] || ''}</th>
                                    <th class="py-2 border h-12 blok">${headerData[7] || ''}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="px-4 py-2 border h-24">
                                        <div class="text-lg font-bold">${dayName}</div>
                                        <div class="text-3xl font-bold">${day}</div>
                                    </td>
                                    <td class="px-4 py-2 border h-24" id="name1Cell" colspan="2"></td>
                                    <td class="px-4 py-2 border h-24" id="name2Cell" colspan="2"></td>
                                    <td class="px-4 py-2 border h-24" id="name3Cell" colspan="2"></td>
                                    <td class="px-4 py-2 border h-24" id="name4Cell" colspan="2"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
                tablesContainer.appendChild(table);
            }

            // Save the generated schedule to localStorage
            localStorage.setItem('generatedSchedule', tablesContainer.innerHTML);
        }

        function printContent() {
            window.print();
        }

        function downloadPDF() {
            const tablesContainer = document.getElementById('tablesContainer');
            html2canvas(tablesContainer).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save('schedule.pdf');
            });
        }

        window.onload = function() {
            loadSettingsData();
            const savedSchedule = localStorage.getItem('generatedSchedule');
            if (savedSchedule) {
                document.getElementById('tablesContainer').innerHTML = savedSchedule;
            }
            document.addEventListener('click', function(event) {
                const menu = document.getElementById('dropdownMenu');
                if (!menu.contains(event.target) && !event.target.closest('.fa-bars')) {
                   menu.classList.add('hidden');
                }
            });
        };
    </script>
</body>
</html>