<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>RT 09</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="/logo.png" rel="icon" type="image/jpeg"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    main {
      flex: 1;
    }
    table {
      -webkit-print-color-adjust: exact;
      border-collapse: collapse;
    }
    th, td {
      white-space: nowrap;
      border: 1px solid gray;
    }
    table tr:nth-child(even) {
      background-color: #0f766e3b;
    }
    table tr:hover {
      background-color: #fbbf24;
    }
    .grid-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .grid-item img {
      width: 50px;
      height: 50px;
      margin-right: 10px;
    }
    .grid-item .left {
      display: flex;
      align-items: center;
    }
    .grid-item .right {
      text-align: right;
    }
    @media (max-width: 640px) {
      #search-input {
        width: 100% !important;
      }
      .flex {
        flex-direction: row;
        flex-wrap: wrap;
      }
      #print-button, .fa-bell {display:none;}
    }
    .tooltip {
      position: absolute;
      background-color: #333;
      color: #fff;
      padding: 5px;
      border-radius: 5px;
      font-size: 12px;
      display: none;
      z-index: 1000;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      width: 90%;
      max-width: 600px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
    .jadwal {
      float: right;
      position: sticky;
      margin-top: -80px;
      margin-bottom: 10px;
    }
    .jadwal img {
      border: 2px solid #6b7280;
      padding: 5px;
    }
    .jadwal p {
      padding-top: 88px;
    }
    .tgl {
      margin-left: -6px;
      margin-right: 2px;
      border: 2px solid;
    }
    .jadwalhari {
      margin-left: -15px;
      margin-right: -15px;
    }
span.priode {
    font-size: xx-small;
    color: white;
    background: red;
    padding: 0 5px;
    border-radius: 5px;
    margin-left: -55px;
    margin-top: -35px;
}
main {
    margin-top: 60px;
}
.header.bg-teal-700.p-4.flex.items-center.justify-between.relative {
    position: fixed;
    width: -webkit-fill-available;
    width: 100%;
    z-index: 1;
}
#search-input {
max-width:90%;
}
  </style>
</head>
<body class="bg-gray-100">
  <!-- Header -->
  <div class="header bg-teal-700 p-4 flex items-center justify-between relative">
    <div class="flex items-center">
      <img alt="Logo of RT09 community" height="28" src="/logo.png" style="max-height:28px" width="28"/>
      <h1 class="text-white text-xl ml-4 cursor-pointer" id="pemasukan-data">RT09</h1><span class="priode">2015 - 2025</span>
    </div>
    <div class="flex items-center space-x-4">
      <a href="?jadwalronda" id="menu-link">
        <i class="fas bg-yellow-400 rounded px-2 py-1 text-sm" id="menu-text"> JADWAL</i>
      </a>
      <i class="fas fa-bell text-white text-xl"></i>
      <i class="fas fa-search text-white text-xl cursor-pointer" id="search-icon"></i>
    </div>
    <div class="absolute inset-0 bg-teal-700 p-4 flex items-center justify-center hidden" id="search-bar">
      <input class="w-1/2 p-2 rounded" id="search-input" placeholder="Search by name or block" type="text"/>
      <i class="fas fa-times text-red-600 text-2xl ml-4 cursor-pointer" id="close-search"></i>
    </div>
  </div>
  <!-- Main Content -->
  <main class="container mx-auto p-4">
    <h2 class="text-2xl font-bold mb-4 text-center uppercase" id="report-title">DENDA RONDA 2025</h2>
     <div class="mb-4 flex items-center space-x-4">
      <div>
        <select class="block w-full bg-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline" id="month-select">


<option value="Februari">Februari 2025</option>
          <option value="Januari">Januari 2025</option>

          
          <!--option value="Maret">Maret</option>
          <option value="April">April</option>
          <option value="Mei">Mei</option>
          <option value="Juni">Juni</option>
          <option value="Juli">Juli</option>
          <option value="Agustus">Agustus</option>
          <option value="September">September</option>
          <option value="Oktober">Oktober</option>
          <option value="November">November</option>
          <option value="Desember">Desember</option-->

        </select>
      </div>
      <div>
        <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline hidden" id="toggle-details">
          <i class="fas fa-info-circle"></i>
        </button>
      </div>
      <div>
        <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline" id="toggle-rows">
          <i class="fas fa-eye-slash"></i>
        </button>
      </div>
      <div>
        <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline" id="print-button">
          <i class="fas fa-print"></i>
        </button>
      </div>
      <div>
        <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline" id="toggle-view">
          <i class="fas fa-th-list"></i>
        </button>
      </div>
    </div>
    <div class="hidden overflow-x-auto" id="table-view">
      <table class="min-w-full bg-white border border-gray-200">
        <thead>
          <tr>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white">No</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white">Nama</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white">Blok</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white hidden">Tunggakan</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white hidden">Ronda 1</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white hidden">Ronda 2</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white hidden">Ronda 3</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white hidden">Ronda 4</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white hidden">Bulanan</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white">Jumlah</th>
            <th class="px-4 py-2 border text-center bg-teal-700 text-white">Bayar</th>
          </tr>
        </thead>
        <tbody id="data-table-body">
          <!-- Data will be inserted here by JavaScript -->
        </tbody>
      </table>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3" id="grid-view">
      <!-- Grid items will be inserted here by JavaScript -->
    </div>
  </main>
  <!-- Search Results Page -->
  <main class="container mx-auto p-4 hidden" id="search-results-page">
    <h1 class="text-2xl font-bold mb-4 text-center uppercase">PENCARIAN DATA</h1>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="search-results">
    </div>
    <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline mb-4" id="back-button">
      Kembali
    </button>
  </main>
  <!-- Detail Page -->
  <main class="container mx-auto p-4 hidden" id="detail-page">
    <div class="relative">
      <img alt="Cover photo of the selected block" class="w-full h-64 object-cover" id="detail-cover" src=""/>
      <div class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 text-white">
        <h1 class="text-3xl font-bold" id="detail-title"></h1>
      </div>
    </div>
    <div class="p-4 bg-white shadow rounded mt-4">
      <h2 class="text-xl font-bold mb-2">Rincian Denda Ronda</h2>
      <div id="detail-content">
        <!-- Detailed content will be inserted here by JavaScript -->
      </div>
      <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline mt-4" id="back-to-main">
        Kembali
      </button>
    </div>
  </main>
  <!-- Rincian Page -->
  <main class="container mx-auto p-4 hidden" id="rincian-page">
    <div class="relative">
      <img alt="Cover photo of the selected block" class="w-full h-64 object-cover" id="rincian-cover" src=""/>
      <div class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 text-white">
        <h1 class="text-3xl font-bold" id="rincian-title"></h1>
      </div>
    </div>
    <div class="p-4 bg-white shadow rounded mt-4">
      <h2 class="text-xl font-bold mb-2">Rincian Denda Ronda</h2>
      <div id="rincian-content">
        <!-- Detailed content will be inserted here by JavaScript -->
      </div>
      <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline mt-4" id="back-to-search">
        Kembali
      </button>
    </div>
  </main>
  <!-- Jadwal Ronda Page -->
  <main class="container mx-auto p-4 hidden" id="jadwal-ronda-page">
    <h1 class="text-2xl font-bold mb-4 text-center uppercase" id="jadwal-title">JADWAL RONDA</h1>
    <div class="mb-4 flex items-center space-x-4">
      <div>
        <select class="block w-full bg-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline" id="jadwal-month-select">
          <option value="Januari">Januari</option>
          <option value="Februari">Februari</option>
          <!--option value="Maret">Maret</option>
          <option value="April">April</option>
          <option value="Mei">Mei</option>
          <option value="Juni">Juni</option>
          <option value="Juli">Juli</option>
          <option value="Agustus">Agustus</option>
          <option value="September">September</option>
          <option value="Oktober">Oktober</option>
          <option value="November">November</option>
          <option value="Desember">Desember</option-->
        </select>
      </div>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="jadwal-ronda-grid">
      <!-- Jadwal Ronda items will be inserted here by JavaScript -->
    </div>
    <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline mt-4" id="back-to-main-from-jadwal">
      Kembali
    </button>
  </main>
  <!-- Pemasukan Page -->
  <main class="container mx-auto p-4 hidden" id="pemasukan-page">
    <h1 class="text-2xl font-bold mb-4 text-center uppercase">PEMASUKAN DENDA RONDA</h1>
    <div class="mb-4 flex items-center space-x-4" id="pemasukan-data">
      <div>
        <select class="block w-full bg-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline" id="year-select">
          <option value="2015">2015</option>
          <option value="2016">2016</option>
          <option value="2017">2017</option>
          <option value="2018">2018</option>
          <option value="2019">2019</option>
          <option value="2020">2020</option>
          <option value="2021">2021</option>
          <option value="2022">2022</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
        </select>
      </div>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="pemasukan-grid">
      <!-- Pemasukan items will be inserted here by JavaScript -->
    </div>
    <button class="block w-full bg-teal-700 text-white border border-gray-300 rounded py-2 px-3 shadow leading-tight focus:outline-none focus:shadow-outline mt-4" id="back-to-main-from-pemasukan">
      Kembali
    </button>
  </main>
  <!-- Footer -->
  <footer class="bg-teal-700 text-white py-4">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center">
        <p>© 2025 Youshe.</p>
        <div class="flex space-x-4">
          <a class="text-white" href="/la6.apk">
            <i class="fas fa-download"></i>
            Unduh Aplikasi
          </a>
        </div>
      </div>
    </div>
  </footer>
  <div class="tooltip" id="tooltip"></div>
  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content" id="content-to-capture">   
      <h1 class="text-center text-xl font-bold">TAGIHAN DENDA RONDA</h1>
      <p class="text-center text-xs">Perum Loh Agung 6 &amp; Kavling RT 09 RW 23 Jaten Karanganyar</p>
      <div class="flex justify-between mt-4">
        <p class="text-left" id="modal-no"></p>
        <p class="text-right" id="modal-name-block"></p>
      </div>
      <hr class="my-2"/>
      <div class="flex justify-between">
        <p>Tunggakan</p>
        <p class="text-right" id="modal-tunggakan"></p>
      </div>
      <div class="flex justify-between">
        <p>Ronda 1</p>
        <p class="text-right" id="modal-ronda1"></p>
      </div>
      <div class="flex justify-between">
        <p>Ronda 2</p>
        <p class="text-right" id="modal-ronda2"></p>
      </div>
      <div class="flex justify-between">
        <p>Ronda 3</p>
        <p class="text-right" id="modal-ronda3"></p>
      </div>
      <div class="flex justify-between">
        <p>Ronda 4</p>
        <p class="text-right" id="modal-ronda4"></p>
      </div>
      <div class="flex justify-between">
        <p>Bulanan</p>
        <p class="text-right" id="modal-bulanan"></p>
      </div>
      <hr class="my-2"/>
      <div class="flex justify-between">
        <p>TOTAL</p>
        <p class="text-right text-red-500 font-bold" id="modal-total"></p>
      </div>
      <div class="flex justify-between">
        <p>Bayar</p>
        <p class="text-right" id="modal-bayar"></p>
      </div>
<hr class="my-2"/>
      <div class="flex justify-between">
        <p>Kurang</p>
        <p class="text-right" id="modal-jumlah"></p>
      </div>

      <p class="text-center mt-4"> </p>
      <p class="text-center">Seksi Keamanan</p>
      <button class="text-center" id="download-button">Simpan</button><span class="close">×</span>
    </div>
  </div>
<script>
    let showDetails = false;
    let showAll = false;
    let isGridView = true;

    // Function to fetch data from Google Sheets API
    async function fetchData(month) {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/1Qw0SRi6bR58vmz6fTdv9Wm2YQ4PlMZOfsZBxmHyi5HY/values/${month}?key=AIzaSyAjDxHHEvzLicx3-7HHGsFCmXFdhKtypN4`);
        const data = await response.json();
        const rows = data.values;
        const tableBody = document.getElementById('data-table-body');
        const gridView = document.getElementById('grid-view');
        tableBody.innerHTML = ''; // Clear existing data
        gridView.innerHTML = ''; // Clear existing data

        rows.forEach((row, index) => {
            if (index === 0) return; // Skip header row

            // Table Row
            const tr = document.createElement('tr');
            const tdNo = document.createElement('td');
            tdNo.className = 'px-4 py-2 border text-center';
            tdNo.textContent = index; // Row number
            tr.appendChild(tdNo);

            row.forEach((cell, cellIndex) => {
                const td = document.createElement('td');
                td.className = 'px-4 py-2 border';
                if (cellIndex === 0) { // Left align "Nama"
                    td.classList.add('text-left');
                    td.classList.add('cursor-pointer');
                    td.addEventListener('click', () => showModal(index, row));
                } else if (cellIndex === 2 || cellIndex >= 3) { // Right align specific columns
                    td.classList.add('text-right');
                } else { // Center align other columns
                    td.classList.add('text-center');
                }

                td.textContent = cell;

                tr.appendChild(td);
            });

            // Check if "Jumlah" column has "Rp0" and set "Bayar" column accordingly
            const jumlahCell = tr.children[9];
            const bayarCell = tr.children[10];
            if (jumlahCell.textContent.trim() === 'Rp0') {
                bayarCell.innerHTML = '<i class="fas fa-check text-green-500 font-bold"></i> <span class="text-green-500 font-bold">LUNAS</span>';
                bayarCell.addEventListener('click', () => {
                    const originalValue = row[9];
                    bayarCell.innerHTML = originalValue;
                    setTimeout(() => {
                        bayarCell.innerHTML = '<i class="fas fa-check text-green-500 font-bold"></i> <span class="text-green-500 font-bold">LUNAS</span>';
                    }, 5000);
                });
            } else if (jumlahCell.textContent.trim() !== 'Rp0' && bayarCell.textContent.trim() === 'Rp0') {
                bayarCell.innerHTML = '<span class="text-red-500 font-bold">Belum Bayar</span>';
            }

            // Add event listener for showing tooltip on "Jumlah" column
            jumlahCell.addEventListener('click', (event) => {
                const tooltip = document.getElementById('tooltip');
                const nama = row[0];
                const blok = row[1];
                tooltip.textContent = `${nama} - ${blok}`;
                tooltip.style.display = 'block';
                tooltip.style.left = `${event.pageX}px`;
                tooltip.style.top = `${event.pageY}px`;
                setTimeout(() => {
                    tooltip.style.display = 'none';
                }, 5000);
            });

            tableBody.appendChild(tr);

            // Grid Item 
            const gridItem = document.createElement('div');
            gridItem.className = 'bg-white p-2 rounded shadow flex items-center grid-item hover:bg-yellow-300 cursor-pointer';
            const total = row[8]; // Use the value from column 8 for "Jumlah"
            const imageName = row[1].replace(/[\s.]/g, '').toLowerCase();
            const jumlahContent = total.trim() === 'Rp0' 
                ? '<div class="text-green-600 p-2 rounded"><b class="fas fa-check text-xl"> Lunas</b></div>'
                : `<div class="bg-red-500 text-white p-2 rounded">${total}</div>`;
            const bayarContent = total.trim() === 'Rp0'
                ? ''
                : (row[9].trim() === 'Rp0' ?'' : 'Bayar: <b class="text-green-500"">' + row[9]) + '</b>';             
            gridItem.innerHTML = `
                <div class="left">
                    <img src="/file/${imageName}.jpg" 
                         alt="Tagihan Denda Ronda ${row[0]}" 
                         class="w-24 h-24 rounded-full mb-2"
                         onerror="this.onerror=null; this.src='/file/no-profil.jpeg';">
                    <div>
                        <p class="text-lg font-bold">${row[0]}</p>
                        <p class="text-sm text-gray-500">Blok <b class="text-sm text-teal-700">${row[1]}</b></p>
                    </div>
                </div>
                <div class="right">
                    <p class="text-sm">${jumlahContent}</p>
                    <p class="text-sm text-gray-600">${bayarContent}</p>
                </div>
            `;
            gridItem.addEventListener('click', () => showDetailPage(index, row));
            gridView.appendChild(gridItem);
        });

        // Hide empty rows by default
        toggleRows();
        // Apply hidden columns if details are toggled off
        if (!showDetails) {
            toggleDetails();
        }
    }

    // Function to fetch data from "Pemasukan" sheet
    async function fetchPemasukanData() {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/1Qw0SRi6bR58vmz6fTdv9Wm2YQ4PlMZOfsZBxmHyi5HY/values/Pemasukan?key=AIzaSyAjDxHHEvzLicx3-7HHGsFCmXFdhKtypN4`);
        const data = await response.json();
        const rows = data.values;
        const row15ColumnB = document.getElementById('pemasukan-data');
        row15ColumnB.textContent =
            rows[15] && rows[15][1] // Memastikan data tersedia
                ? rows[15][1]
                : 'Data tidak tersedia';
    }

    // Fetch pemasukan data on page load
    fetchPemasukanData();

    // Event listener for month selection change
    document.getElementById('month-select').addEventListener('change', (event) => {
        const selectedMonth = event.target.value;
        document.getElementById('report-title').textContent = `DENDA RONDA ${selectedMonth.toUpperCase()}`;
        fetchData(selectedMonth);
        showDetails = true;
        toggleDetails();
    });

    // Initial fetch for default month
    fetchData('Februari');

    // Search functionality
    document.getElementById('search-icon').addEventListener('click', () => {
        document.getElementById('search-bar').classList.remove('hidden');
    });

    document.getElementById('close-search').addEventListener('click', () => {
        document.getElementById('search-bar').classList.add('hidden');
    });

    document.getElementById('search-input').addEventListener('input', (event) => {
        const searchTerm = event.target.value.toLowerCase();
        const rows = document.querySelectorAll('#data-table-body tr');
        const searchResults = document.getElementById('search-results');
        searchResults.innerHTML = ''; // Clear previous search results

        rows.forEach(row => {
            const name = row.children[1].textContent.toLowerCase();
            const block = row.children[2].textContent.toLowerCase();
            if (name.includes(searchTerm) || block.includes(searchTerm)) {
                const resultItem = document.createElement('div');
                resultItem.className = 'bg-white p-2 rounded shadow flex items-center grid-item hover:bg-yellow-500 cursor-pointer';
                const total = row.children[9].textContent.trim();
                const imageName = row.children[2].textContent.replace(/[\s.]/g, '').toLowerCase();
                resultItem.innerHTML = `
                    <div class="left">
                        <img src="/file/${imageName}.jpg" 
                             alt="Profile picture of ${row.children[1].textContent}" 
                             class="w-24 h-24 rounded-full mb-2"
                             onerror="this.onerror=null; this.src='/file/no-profil.jpeg';">
                        <div>
                            <p class="text-lg font-bold">${row.children[1].textContent}</p>
                         </div>
                    </div>
                    <div class="right">
                        <p class="bg-red-500 text-white p-2 rounded"">${row.children[2].textContent}</p>
                    </div>
                `;
                resultItem.addEventListener('click', () => showRincianPage(Array.from(rows).indexOf(row), Array.from(row.children).map(cell => cell.textContent)));
                searchResults.appendChild(resultItem);
            }
        });

        // Show search results page
        document.getElementById('search-results-page').classList.remove('hidden');
        document.querySelector('main.container').classList.add('hidden');
    });

    // Back button functionality
    document.getElementById('back-button').addEventListener('click', () => {
        document.getElementById('search-results-page').classList.add('hidden');
        document.querySelector('main.container').classList.remove('hidden');
    });

    // Toggle rows functionality
    document.getElementById('toggle-rows').addEventListener('click', () => {
        toggleRows();
    });

    function toggleRows() {
        const rows = document.querySelectorAll('#data-table-body tr');
        const gridItems = document.querySelectorAll('#grid-view > div');
        if (showAll) {
            rows.forEach((row, index) => {
                row.classList.remove('hidden');
                row.children[0].textContent = index + 1;
            });
            gridItems.forEach((item, index) => {
                item.classList.remove('hidden');
            });
            document.getElementById('toggle-rows').innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
            let counter = 1;
            rows.forEach(row => {
                if (!row.children[1].textContent.trim()) {
                    row.classList.add('hidden');
                } else {
                    row.children[0].textContent = counter++;
                }
            });
            gridItems.forEach(item => {
                const name = item.querySelector('p.text-lg').textContent.trim();
                if (!name) {
                    item.classList.add('hidden');
                }
            });
            document.getElementById('toggle-rows').innerHTML = '<i class="fas fa-eye"></i>';
        }
        showAll = !showAll;
        updateRowColors();
    }

    function updateRowColors() {
        const rows = document.querySelectorAll('#data-table-body tr:not(.hidden)');
        rows.forEach((row, index) => {
            if (index % 2 === 0) {
                row.style.backgroundColor = '#0f766e3b';
            } else {
                row.style.backgroundColor = 'transparent';
            }
        });
    }

    // Print functionality
    document.getElementById('print-button').addEventListener('click', () => {
        const printContent = document.getElementById('report-title').outerHTML + document.querySelector('table').outerHTML;
        const originalContent = document.body.innerHTML;
        document.body.innerHTML = printContent;
        window.print();
        document.body.innerHTML = originalContent;
        window.location.reload();
    });

    window.onafterprint = () => {
        window.location.reload();
    };

    // Modal functionality
    const modal = document.getElementById('modal');
    const span = document.getElementsByClassName('close')[0];

    span.onclick = function() {
        modal.style.display = 'none';
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }

    function showModal(index, row) {
        document.getElementById('modal-no').textContent = `NO. ${index}`;
        document.getElementById('modal-name-block').textContent = `${row[0]} - ${row[1]}`;
        document.getElementById('modal-tunggakan').textContent = row[2];
        document.getElementById('modal-ronda1').textContent = row[3];
        document.getElementById('modal-ronda2').textContent = row[4];
        document.getElementById('modal-ronda3').textContent = row[5];
        document.getElementById('modal-ronda4').textContent = row[6];
        document.getElementById('modal-bulanan').textContent = row[7];

        // Calculate total
        const total = [row[2], row[3], row[4], row[5], row[6], row[7]].reduce((acc, val) => {
            const num = parseInt(val.replace(/[^0-9]/g, ''), 10) || 0;
            return acc + num;
        }, 0);
        document.getElementById('modal-total').textContent = `Rp${total.toLocaleString('id-ID')}`;

        document.getElementById('modal-jumlah').textContent = row[8];
        document.getElementById('modal-bayar').textContent = row[9];
        modal.style.display = 'flex';
    }

    document.getElementById('download-button').addEventListener('click', function () {
        const content = document.getElementById('content-to-capture');
        html2canvas(content).then(canvas => {
            const link = document.createElement('a');
            link.download = 'tagihan-denda-ronda.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    });

    // Toggle view functionality
    document.getElementById('toggle-view').addEventListener('click', () => {
        isGridView = !isGridView;
        document.getElementById('table-view').classList.toggle('hidden', isGridView);
        document.getElementById('grid-view').classList.toggle('hidden', !isGridView);
        document.getElementById('toggle-view').innerHTML = isGridView ? '<i class="fas fa-th-list"></i>' : '<i class="fas fa-th-large"></i>';
        document.getElementById('toggle-details').classList.toggle('hidden', isGridView);
    });

    // Toggle details functionality
    document.getElementById('toggle-details').addEventListener('click', () => {
        toggleDetails();
    });

    function toggleDetails() {
        showDetails = !showDetails;
        const detailColumns = document.querySelectorAll('th:nth-child(4), th:nth-child(5), th:nth-child(6), th:nth-child(7), th:nth-child(8), th:nth-child(9), td:nth-child(4), td:nth-child(5), td:nth-child(6), td:nth-child(7), td:nth-child(8), td:nth-child(9)');
        const noColumn = document.querySelectorAll('th:nth-child(1), td:nth-child(1)');
        detailColumns.forEach(column => {
            column.classList.toggle('hidden', showDetails);
        });
        noColumn.forEach(column => {
            column.classList.toggle('hidden', showDetails);
        });
    }

    // Show Detail Page
    function showDetailPage(index, row) {
        document.getElementById('detail-title').textContent = `${row[0]} - ${row[1]}`;
        const imageName = row[1].replace(/[\s.]/g, '').toLowerCase();
        document.getElementById('detail-cover').src = `/file/${imageName}.jpg`;
        document.getElementById('detail-cover').onerror = function() {
            this.onerror = null;
            this.src = '/file/no-profil.jpeg';
        };
        const total = [row[2], row[3], row[4], row[5], row[6], row[7]].reduce((acc, val) => {
            const num = parseInt(val.replace(/[^0-9]/g, ''), 10) || 0;
            return acc + num;
        }, 0);
        const detailContent = `
            <div class="flex justify-between">
                <p>Tunggakan</p>
                <p class="text-right">${row[2]}</p>
            </div>
            <div class="flex justify-between">
                <p>Ronda 1</p>
                <p class="text-right">${row[3]}</p>
            </div>
            <div class="flex justify-between">
                <p>Ronda 2</p>
                <p class="text-right">${row[4]}</p>
            </div>
            <div class="flex justify-between">
                <p>Ronda 3</p>
                <p class="text-right">${row[5]}</p>
            </div>
            <div class="flex justify-between">
                <p>Ronda 4</p>
                <p class="text-right">${row[6]}</p>
            </div>
            <div class="flex justify-between">
                <p>Bulanan</p>
                <p class="text-right">${row[7]}</p>
            </div>
            <hr class="my-2"/>
            <div class="flex justify-between">
                <p>TOTAL</p>
                <p class="text-right text-red-500 font-bold">Rp${total.toLocaleString('id-ID')}</p>
            </div>
            <div class="flex justify-between">
                <p>Bayar</p>
                <p class="text-right">${row[9]}</p>
            </div>
            <hr class="my-2"/>
            <div class="flex justify-between">
                <p>Kekurangan</p>
                <p class="text-right text-red-500 font-bold">${row[8]}</p>
            </div>
        `;
        document.getElementById('detail-content').innerHTML = detailContent;
        document.getElementById('detail-page').classList.remove('hidden');
        document.querySelector('main.container').classList.add('hidden');
    }

    // Show Rincian Page
    function showRincianPage(index, row) {
        document.getElementById('rincian-title').textContent = `${row[1]} - ${row[2]}`;
        const imageName = row[2].replace(/[\s.]/g, '').toLowerCase();
        document.getElementById('rincian-cover').src = `/file/${imageName}.jpg`;
        document.getElementById('rincian-cover').onerror = function() {
            this.onerror = null;
            this.src = '/file/no-profil.jpeg';
        };
        const total = [row[3], row[4], row[5], row[6], row[7], row[8]].reduce((acc, val) => {
            const num = parseInt(val.replace(/[^0-9]/g, ''), 10) || 0;
            return acc + num;
        }, 0);
        const rincianContent = `
            <div class="flex justify-between">
                <p>Tunggakan</p>
                <p class="text-right">${row[3]}</p>
            </div>
            <div class="flex justify-between">
                <p>Ronda 1</p>
                <p class="text-right">${row[4]}</p>
            </div>
            <div class="flex justify-between">
                <p>Ronda 2</p>
                <p class="text-right">${row[5]}</p>
            </div>
            <div class="flex justify-between">
                <p>Ronda 3</p>
                <p class="text-right">${row[6]}</p>
            </div>
            <div class="flex justify-between">
                <p>Ronda 4</p>
                <p class="text-right">${row[7]}</p>
            </div>
            <div class="flex justify-between">
                <p>Bulanan</p>
                <p class="text-right">${row[8]}</p>
            </div>
            <hr class="my-2"/>
            <div class="flex justify-between">
                <p>TOTAL</p>
                <p class="text-right text-red-500 font-bold">Rp${total.toLocaleString('id-ID')}</p>
            </div>

            <div class="flex justify-between">
                <p>Bayar</p>
                <p class="text-right">${row[10]}</p>
            </div>
            <hr class="my-2"/>
            <div class="flex justify-between">
                <p>Kekurangan</p>
                <p class="text-right text-red-500 font-bold">${row[9]}</p>
            </div>
        `;
        document.getElementById('rincian-content').innerHTML = rincianContent;
        document.getElementById('rincian-page').classList.remove('hidden');
        document.getElementById('search-results-page').classList.add('hidden');
    }

    // Back to main page from detail page
    document.getElementById('back-to-main').addEventListener('click', () => {
        document.getElementById('detail-page').classList.add('hidden');
        document.querySelector('main.container').classList.remove('hidden');
    });

    // Back to search results page from rincian page
    document.getElementById('back-to-search').addEventListener('click', () => {
        document.getElementById('rincian-page').classList.add('hidden');
        document.getElementById('search-results-page').classList.remove('hidden');
    });

    // Back to main page from jadwal ronda page
    document.getElementById('back-to-main-from-jadwal').addEventListener('click', () => {
        document.getElementById('jadwal-ronda-page').classList.add('hidden');
        document.querySelector('main.container').classList.remove('hidden');
        document.getElementById('search-icon').classList.remove('hidden');
    });

    // Function to fetch jadwal ronda data from Google Sheets API
    async function fetchJadwalRonda(month) {
        try {
            const response = await fetch(
                `https://sheets.googleapis.com/v4/spreadsheets/1Qw0SRi6bR58vmz6fTdv9Wm2YQ4PlMZOfsZBxmHyi5HY/values/Jadwal?key=AIzaSyAjDxHHEvzLicx3-7HHGsFCmXFdhKtypN4`
            );

            if (!response.ok) throw new Error('Failed to fetch data from Google Sheets.');

            const data = await response.json();
            const rows = data.values;
            const jadwalRondaGrid = document.getElementById('jadwal-ronda-grid');
            jadwalRondaGrid.innerHTML = ''; // Clear existing data

            const monthIndex = {
                'Januari': 0,
                'Februari': 10,
                'Maret': 20,
                'April': 30,
                'Mei': 40,
                'Juni': 50,
                'Juli': 60,
                'Agustus': 70,
                'September': 80,
                'Oktober': 90,
                'November': 100,
                'Desember': 110,
            };

            const startRow = monthIndex[month];
            const endRow = startRow + 9;

            if (startRow === undefined) {
                throw new Error('Invalid month selected.');
            }

            // Calculate days in the month
            const daysInMonth = new Date(new Date().getFullYear(), Object.keys(monthIndex).indexOf(month) + 1, 0).getDate();

            for (let i = startRow; i <= endRow; i++) {
                const row = rows[i];
                if (!row) continue;

                const teamNumber = i - startRow + 1;
                const teamItem = document.createElement('div');
                teamItem.className = 'bg-white p-4 rounded shadow';
                const dates = [];
                for (let day = teamNumber; day <= daysInMonth; day += 10) {
                    const date = new Date(new Date().getFullYear(), Object.keys(monthIndex).indexOf(month), day);
                    const dayName = date.toLocaleDateString('id-ID', { weekday: 'long' });
                    dates.push(`<b class="jadwalnama bg-gray-500 px-1 p-1 border rounded"> ${dayName} </b><b class="tgl bg-red-500 p-2 rounded-full shadow "> ${day.toString().padStart(2, '0')}</b>`);
                }
                teamItem.innerHTML = `
                    <h2 class=" text-lg font-bold mb-2 text-center ">Team Ronda #${teamNumber}</h2><p class="jadwalhari mt-2 mb-6 text-xs text-white text-center py-3 bg-teal-700"> ${dates.join('')}</p>
                    <p>${row[0] ? `<i class="fas fa-user text-red-600 px-4"></i> ${row[0]}` : ''}</p>
                    <p>${row[1] ? `<i class="fas fa-user text-gray-600 px-4"></i> ${row[1]}` : ''}</p>
                    <p>${row[2] ? `<i class="fas fa-user text-gray-600 px-4"></i> ${row[2]}` : ''}</p>
                    <p>${row[3] ? `<i class="fas fa-user text-gray-600 px-4"></i> ${row[3]}` : ''}</p>
<div class="jadwal text-center relative w-24 h-24 mx-auto">
  <img src="/file/${row[4]}.jpg" 
       alt="Profile picture of ${row[0]}" 
       class="w-full h-full rounded-full object-cover"
       onerror="this.onerror=null; this.src='/file/no-profil.jpeg';">
  <p class="absolute inset-0 flex items-center justify-center text-white text-lg font-bold bg-opacity-50 rounded-full">
    <b class="bg-yellow-600 rounded shadow px-2 text-sm">Ketua #${teamNumber}</b>
  </p>
</div>
                `;
                jadwalRondaGrid.appendChild(teamItem);
            }
        } catch (error) {
            console.error('Error:', error.message);
            alert('Gagal memuat data jadwal ronda. Silakan coba lagi.');
        }
    }

    // Event listener for jadwal month selection change
    document.getElementById('jadwal-month-select').addEventListener('change', (event) => {
        const selectedMonth = event.target.value;
        document.getElementById('jadwal-title').textContent = `JADWAL RONDA ${selectedMonth.toUpperCase()}`;
        fetchJadwalRonda(selectedMonth);
    });

    // Initial fetch for default month in jadwal ronda
    fetchJadwalRonda('Januari');

    // Show Jadwal Ronda Page
    if (window.location.search.includes('jadwalronda')) {
        document.getElementById('jadwal-ronda-page').classList.remove('hidden');
        document.querySelector('main.container').classList.add('hidden');
        document.getElementById('menu-link').href = '?dendaronda';
        document.getElementById('menu-text').textContent = 'DENDA RONDA';
        document.getElementById('search-icon').classList.add('hidden');
    }

    // Show Pemasukan Page
    document.getElementById('pemasukan-data').addEventListener('click', () => {
        document.getElementById('pemasukan-page').classList.remove('hidden');
        document.querySelector('main.container').classList.add('hidden');
        document.getElementById('search-icon').classList.add('hidden');
        fetchPemasukanData();
    });

    // Back to main page from pemasukan page
    document.getElementById('back-to-main-from-pemasukan').addEventListener('click', () => {
        document.getElementById('pemasukan-page').classList.add('hidden');
        document.querySelector('main.container').classList.remove('hidden');
        document.getElementById('search-icon').classList.remove('hidden');
    });

    // Function to fetch pemasukan data for a specific year
    async function fetchPemasukanDataForYear(year) {
        try {
            const response = await fetch(
                `https://sheets.googleapis.com/v4/spreadsheets/1Qw0SRi6bR58vmz6fTdv9Wm2YQ4PlMZOfsZBxmHyi5HY/values/Pemasukan?key=AIzaSyAjDxHHEvzLicx3-7HHGsFCmXFdhKtypN4`
            );

            if (!response.ok) throw new Error('Failed to fetch data from Google Sheets.');

            const data = await response.json();
            const rows = data.values;
            const pemasukanGrid = document.getElementById('pemasukan-grid');
            pemasukanGrid.innerHTML = ''; // Clear existing data

            const months = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember','Total'
            ];

            for (let i = 1; i <= 13; i++) {
                const row = rows[i];
                if (!row) continue;

                const monthItem = document.createElement('div');
                monthItem.className = 'bg-white p-4 rounded shadow flex justify-between items-center';
                monthItem.innerHTML = `
                    <div class="left">
                        <p class="text-lg font-bold">${months[i - 1]}</p>
                    </div>
                    <div class="right">
                        <p class="text-right">${row[year - 2015 + 1]}</p>
                    </div>
                `;
                pemasukanGrid.appendChild(monthItem);
            }
        } catch (error) {
            console.error('Error:', error.message);
            alert('Gagal memuat data pemasukan. Silakan coba lagi.');
        }
    }

    // Event listener for year selection change
    document.getElementById('year-select').addEventListener('change', (event) => {
        const selectedYear = event.target.value;
        fetchPemasukanDataForYear(selectedYear);
    });

    // Initial fetch for default year in pemasukan
    fetchPemasukanDataForYear(2015);
</script>
</body>
</html>